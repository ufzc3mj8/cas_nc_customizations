<!DOCTYPE html>
<html>
<!-- start right frame -->
<head>
<title>Student Contacts</title>
~[wc:commonscripts]
<link href="/images/css/screen.css" rel="stylesheet" media="screen">
<link href="/images/css/print.css" rel="stylesheet" media="print">
<style type="text/css">
.tlistCollectionTable button.editRow{
    width: 21px;
    height: 21px;
    padding: 0;
    margin-top: 0;
    margin-bottom: 0;
}
.tlistCollectionTable button.editRow em{
	background: url("/images/img/jquery/ui-icons_FFFFFF_256x240.png") no-repeat scroll -64px -112px transparent;
	display: inline-block;
	height: 16px;
	width: 16px;
	margin: 0;
	overflow: hidden;
}
.ui-dialog-titlebar-close {
  visibility: hidden;
}
</style>
</head>

<body>

<form action="/admin/students/studentpages/studentcontacts.html?frn=~(frn)" method="POST" id="mainForm">
~[wc:admin_header_frame_css]<!-- breadcrumb start --><a href="/admin/home.html" target="_top">~[text:psx.html.admin_students.modifydata.start_page]</a> &gt; <a href="home.html?selectstudent=nosearch" target="_top">~[text:psx.html.admin_students.modifydata.student_selection]</a> &gt; Student Contacts<!-- breadcrumb end -->~[wc:admin_navigation_frame_css]

~[wc:title_student_begin_css]Student Contacts~[wc:title_student_end_css]

<!-- start of content and bounding box -->
<div class="box-round" style="display: none" id="tableData">

~[tlist_child:STUDENTS.S_NC_CONTACTS.S_NC_CONTACTS;displaycols:CON_FIRSTNAME,CON_LASTNAME,CON_TYPE,CON_ADDRESS_1,CON_PHONE_1,CON_TYPE_1,CON_PHONE_2,CON_TYPE_2,CON_PHONE_3,CON_TYPE_3,CON_PHONE_4,CON_TYPE_4;fieldNames:First Name,Last Name,Contact Type,Address,Phone 1,Phone 1 Type,Phone 2,Phone 2 Type,Phone 3,Phone 3 Type,Phone 4,Phone 4 Type;type:html]

<div class="button-row"><input type="hidden" name="frn" value="~(studentfrn)"><input type="hidden" name="ac" value="prim">~[submitbutton]</div>
</div>
<br>

<!-- end of content of bounding box -->

~[wc:admin_footer_frame_css]
</form>

<div id="modalData" style="display:none;" title="Edit Record">
    <form action="/admin/students/modifydata.html?frn=~(frn)" method="POST" id="modalForm">
	<table id="modalTable">
	
	</table>
        <input type="hidden" name="ac" value="prim"><input type="hidden" name="frn" value="~(studentfrn)">
    </form>
	<p style ="float:right;margin-right:15px;">
		<button type="button" id="modalCancel">Cancel</button>
		<button type="button" id="modalSave">Save</button>
	</p>
</div>

<script type="text/javascript">
$j(document).ready(function(){
	var ddValues = {};
        ddValues['']='';
        ~[tlist_sql;SELECT g.name, g.value FROM gen g WHERE g.cat = 'contact_types' ORDER BY g.sortorder]
	ddValues['~(1;t)']='~(2;t)';
        [/tlist_sql]
	tlistText2DropDown('CON_TYPE',ddValues);
        
        var ptValues = {};
        ptValues['']='';
        ~[tlist_sql;SELECT g.name, g.value FROM gen g WHERE g.cat = 'phone_types' ORDER BY g.sortorder]
        ptValues['~(1;t)']='~(2;t)';
        [/tlist_sql]
	tlistText2DropDown('CON_TYPE_1',ptValues);
	tlistText2DropDown('CON_TYPE_2',ptValues);
	tlistText2DropDown('CON_TYPE_3',ptValues);
	tlistText2DropDown('CON_TYPE_4',ptValues);
        
	//tlistText2Textarea('CON_ADDRESS_1');
        $j('.CON_ADDRESS_1').attr('size','35');
        
	var howManyColumns = 5; //Adjust how many columns you want to show in table
	var totalColumns = $j('#tlistTable th').length-1; //Count number of columns in table not including Delete Column
	$j('#tlistTable th:nth-child('+totalColumns+1+')').html('');
        // Hide table columns for easy viewing
        for (i=howManyColumns+1;i<=totalColumns;i++) {
	    $j('#tlistTable td:nth-child('+i+'),th:nth-child('+i+')').hide();
	}
        
        // Add edit button for easy editing of entire record
        $j('.deleteCB').each( function(index, value) {
        	index++;
            $j(this).after('<button class="editRow" type="button" onClick="editRow('+index+')"><em>&nbsp\;</em></button>');
        });
        
        $j('#modalCancel').click(function(){
            $j('#modalData').dialog('close');
            $j('#modalTable').html('');
        });
        $j('#modalSave').click(function(){
            $j('#modalData').dialog('close');
            $j('#modalForm').submit();
        });
        
	setTimeout(function() {
	    $j(":button:first-child")
		.filter(function(index) {
		    return $j(this).text() === "Add";
		})
		.click( function() {
		    var newRow = $j('#tlistTable>tbody>tr').length - 1; //Do not count very last hidden row in table
		    tlistText2DropDown('CON_TYPE',ddValues,0,newRow-1); //Adjust for zero-index
                    tlistText2DropDown('CON_TYPE_1',ptValues,0,newRow-1); //Adjust for zero-index
                    tlistText2DropDown('CON_TYPE_2',ptValues,0,newRow-1); //Adjust for zero-index
                    tlistText2DropDown('CON_TYPE_3',ptValues,0,newRow-1); //Adjust for zero-index
                    tlistText2DropDown('CON_TYPE_4',ptValues,0,newRow-1); //Adjust for zero-index
		    //tlistText2Textarea('CON_ADDRESS_1',0,newRow-1); //Adjust for zero-index
		    editRow(newRow);
		}); 
	    }, 1000
	);
	
        $j('#tableData').show();
});

function editRow(rowNum){
    var tableRow=$j('#tlistTable > tbody > tr:eq('+rowNum+') > td');
    tableRow.each(function(i){
    	if(!($j("#tlistTable tr:eq("+rowNum+") td:eq("+i+") button").hasClass('deleteRow'))){
            var evenodd = i%2;
	    var stripe = '#D7EBF4'
	    if (evenodd === 1) {stripe = '#FFFFFF'};
	    rLabel=$j("#tlistTable th:eq("+i+")").text();
            rFieldVal=$j("#tlistTable tr:eq("+rowNum+") td:eq("+i+") input").val();
            rFieldHtml=$j("#tlistTable tr:eq("+rowNum+") td:eq("+i+")").html();
            rField=rFieldHtml;
            $j('#modalTable').append('<tr bgcolor="'+stripe+'"><td>'+ rLabel +'</td><td>'+ rField +'</td></tr>');		    	
    	};
    });
    $j('#modalData').dialog({
        modal:true,
        show: {
          effect: "blind",
          duration: 500
        },
        hide: {
          effect: "blind",
          duration: 500
        },
        width: 450
    });
}


function tlistText2DropDown(fieldName,ddRows,rowIndex,newRow){
    if (rowIndex === 0) { //rowIndex will be 0 for new rows
	var fqTD = $j('#tlistTable > tbody > tr:eq('+newRow+') > td > input.'+fieldName).parent();
    } else {
	var fqTD = $j("#tlistTable > tbody > tr > #"+fieldName);
    }
    fqTD.each(function(x,TDHTML){
        var tdElement = $j(TDHTML);
        var input = tdElement.find("input");
        input.remove();
        var inputName = input.attr("name");
        var inputValue = input.attr("value");
        var select1 = document.createElement("select");
        select1.name=inputName;
        for(var ddRow in ddRows){
            var option1 = document.createElement("option");
            option1.value=ddRow;
            option1.text=ddRows[ddRow];
            if(ddRow==inputValue){
                option1.selected=true;
            }
            select1.options.add(option1);
        }
        tdElement.append(select1);
    });
}
function tlistText2Textarea(fieldName,rowIndex,newRow,numRows,numCols){
    if (rowIndex === 0) { //rowIndex will be 0 for new rows
	var fqTD = $j('#tlistTable > tbody > tr:eq('+newRow+') > td > input.'+fieldName).parent();
    } else {
	var fqTD = $j("#tlistTable > tbody > tr > #"+fieldName);
    }
    fqTD.each(function(x,TDHTML){
        var tdElement = $j(TDHTML);
        var input = tdElement.find("input");
        input.remove();
        var inputName = input.attr("name");
        var inputValue = input.attr("value");
        var textarea1 = document.createElement("textarea");
        textarea1.name=inputName;
	textarea1.value=inputValue;
	textarea1.rows=numRows;
	textarea1.cols=numCols;
        tdElement.append(textarea1);
    });
}
</script>
</body>
</html><!-- end right frame -->